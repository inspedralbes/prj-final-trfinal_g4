"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[1313],{21313:(z,c,s)=>{s.d(c,{ProtectedEditPage:()=>ts});var a=s(74081),e=s(27279),m=s(73354),P=s(27875),i=s(48102),O=s(74758),g=s(93415),h=s(10701),D=s(32370),A=s(23298),L=s(74577),I=s(79213),t=s(87006),U=s(59082),T=s(76827),R=s(71563),r=s(47184),_=s(61020),d=s(51447),u=s(47533),v=s(47853),l=s(6606),n=s(42791),K=s(58647),F=s(91224),G=s(15816),Q=s(97442),E=s(13576),ds=s(87830),ls=s(364),Es=s(59461),Ms=s(49204),ms=s(74919),Ps=s(29206),Os=s(40464),Ds=s(98934),cs=s(43433),gs=s(75719),hs=s(8175),As=s(6078),Ls=s(51943),vs=s(55783),Cs=s(92249),fs=s(41942),Is=s(22919),Us=s(53915),us=s(75041),Bs=s(30200),ps=s(91379),Ts=s(33299),Rs=s(33409),Ks=s(63645),Ws=s(7988),xs=s(7055),js=s(26757),ys=s(58311),Ss=s(24840),Zs=s(29510),zs=s(16946),Fs=s(10124),Ns=s(69530),Ys=s(86961),Vs=s(51527),$s=s(19764),Hs=s(42982),Js=s(26126),Xs=s(64797),Gs=s(85811),Qs=s(86492);const q=v.Ry().shape({...F.C,isActive:v.Xg(),roles:v.IX().min(1,t.I0.required).required(t.I0.required)}),w=["email","firstname","lastname","username","isActive","roles"],ss=()=>{const{formatMessage:o}=(0,_.Z)(),B=(0,d.$B)("/settings/users/:id")?.params?.id??"",{push:p}=(0,d.k6)(),M=(0,t.lm)(),{lockApp:Y,unlockApp:V}=(0,t.o1)(),b=(0,l.p)(K.M,async()=>(await s.e(4474).then(s.bind(s,24474))).MagicLinkEE),{_unstableFormatAPIError:$,_unstableFormatValidationErrors:es}=(0,t.So)(),k=(0,l.j)(n.s),{isLoading:os,allowedActions:{canUpdate:H}}=(0,t.ss)({read:k.settings?.users.read??[],update:k.settings?.users.update??[]}),[ns]=(0,l.M)();(0,t.go)();const{data:is,error:y,isLoading:rs}=(0,l.k)({id:B},{refetchOnMountOrArgChange:!0}),[S]=is?.users??[];if(e.useEffect(()=>{y&&(y.name==="UnauthorizedError"?(M({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),p("/")):M({type:"warning",message:{id:"notification.error",defaultMessage:$(y)}}))},[y,$,p,M]),rs||!b||os)return(0,a.jsxs)(m.o,{"aria-busy":"true",children:[(0,a.jsx)(t.SL,{name:"Users"}),(0,a.jsx)(P.T,{primaryAction:(0,a.jsx)(i.z,{disabled:!0,startIcon:(0,a.jsx)(U.Z,{}),type:"button",size:"L",children:o({id:"global.save",defaultMessage:"Save"})}),title:o({id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}),navigationAction:(0,a.jsx)(I.r,{as:u.OL,startIcon:(0,a.jsx)(T.Z,{}),to:"/settings/users?pageSize=10&page=1&sort=firstname",children:o({id:"global.back",defaultMessage:"Back"})})}),(0,a.jsx)(O.D,{children:(0,a.jsx)(t.dO,{})})]});const Z={...r(S,w),roles:S.roles.map(({id:C})=>C),password:"",confirmPassword:""},_s=async(C,W)=>{Y?.();const{confirmPassword:J,password:x,...X}=C,f=await ns({id:B,...X,password:x===""?void 0:x});"error"in f&&(0,l.x)(f.error)?(f.error.name==="ValidationError"&&W.setErrors(es(f.error)),M({type:"warning",message:$(f.error)})):(M({type:"success",message:o({id:"notification.success.saved",defaultMessage:"Saved"})}),W.setValues({...r(C,w),password:"",confirmPassword:""})),V?.()};return(0,a.jsxs)(m.o,{children:[(0,a.jsx)(t.SL,{name:"Users"}),(0,a.jsx)(R.J9,{onSubmit:_s,initialValues:Z,validateOnChange:!1,validationSchema:q,children:({errors:C,values:W,handleChange:J,isSubmitting:x,dirty:X})=>(0,a.jsxs)(t.l0,{children:[(0,a.jsx)(P.T,{primaryAction:(0,a.jsx)(i.z,{disabled:x||!H?!0:!X,startIcon:(0,a.jsx)(U.Z,{}),loading:x,type:"submit",size:"L",children:o({id:"global.save",defaultMessage:"Save"})}),title:o({id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},{name:Z.username||(0,n.g)(Z?.firstname??"",Z.lastname)}),navigationAction:(0,a.jsx)(I.r,{as:u.OL,startIcon:(0,a.jsx)(T.Z,{}),to:"/settings/users?pageSize=10&page=1&sort=firstname",children:o({id:"global.back",defaultMessage:"Back"})})}),(0,a.jsxs)(O.D,{children:[S?.registrationToken&&(0,a.jsx)(g.x,{paddingBottom:6,children:(0,a.jsx)(b,{registrationToken:S.registrationToken})}),(0,a.jsxs)(h.k,{direction:"column",alignItems:"stretch",gap:7,children:[(0,a.jsx)(g.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,a.jsxs)(h.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,a.jsx)(D.Z,{variant:"delta",as:"h2",children:o({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})}),(0,a.jsx)(A.r,{gap:5,children:as.map(f=>f.map(j=>(0,a.jsx)(L.P,{...j.size,children:(0,a.jsx)(t.jm,{...j,disabled:!H,error:C[j.name],onChange:J,value:W[j.name]})},j.name)))})]})}),(0,a.jsx)(g.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,a.jsxs)(h.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,a.jsx)(D.Z,{variant:"delta",as:"h2",children:o({id:"global.roles",defaultMessage:"User's role"})}),(0,a.jsx)(A.r,{gap:5,children:(0,a.jsx)(L.P,{col:6,xs:12,children:(0,a.jsx)(K.S,{disabled:!H,error:C.roles,onChange:J,value:W.roles})})})]})})]})]})]})})]})},as=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]],ts=()=>{const o=(0,t.lm)(),N=(0,l.j)(n.s),{isLoading:B,allowedActions:{canRead:p,canUpdate:M}}=(0,t.ss)({read:N.settings?.users.read??[],update:N.settings?.users.update??[]}),{state:Y}=(0,d.TH)(),V=Y?.from??"/";return e.useEffect(()=>{B||!p&&!M&&o({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[B,p,M,o]),B?(0,a.jsx)(t.dO,{}):!p&&!M?(0,a.jsx)(d.l_,{to:V}):(0,a.jsx)(ss,{})}},58647:(z,c,s)=>{s.d(c,{M:()=>I,S:()=>t,a:()=>L});var a=s(74081),e=s(61020),m=s(6606),P=s(4987),i=s(97232),O=s(87006),g=s(78031),h=s(34547),D=s(72450),A=s(86492);const L=({children:r,target:_})=>{const d=(0,O.lm)(),{formatMessage:u}=(0,e.Z)(),{copy:v}=(0,O.VP)(),l=u({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),n=async()=>{await v(_)&&d({type:"info",message:{id:"notification.link-copied"}})};return(0,a.jsx)(O.Y_,{endAction:(0,a.jsx)(P.h,{label:l,noBorder:!0,icon:(0,a.jsx)(g.Z,{}),onClick:n}),title:_,titleEllipsis:!0,subtitle:r,icon:(0,a.jsx)("span",{style:{fontSize:32},children:"\u2709\uFE0F"}),iconBackground:"neutral100"})},I=({registrationToken:r})=>{const{formatMessage:_}=(0,e.Z)(),d=`${window.location.origin}${(0,m.K)()}/auth/register?registrationToken=${r}`;return(0,a.jsx)(L,{target:d,children:_({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})})},t=({disabled:r,error:_,onChange:d,value:u})=>{const{isLoading:v,roles:l}=(0,A.u)(),{formatMessage:n}=(0,e.Z)(),K=_?n({id:_,defaultMessage:_}):"",F=n({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),G=n({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),Q=n({id:"app.components.Select.placeholder",defaultMessage:"Select"});return(0,a.jsx)(i.NU,{id:"roles",disabled:r,error:K,hint:G,label:F,name:"roles",onChange:E=>{d({target:{name:"roles",value:E}})},placeholder:Q,startIcon:v?(0,a.jsx)(R,{}):void 0,value:u.map(E=>E.toString()),withTags:!0,required:!0,children:l.map(E=>(0,a.jsx)(i.ML,{value:E.id.toString(),children:n({id:`global.${E.code}`,defaultMessage:E.name})},E.id))})},U=(0,D.F4)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,T=D.ZP.div`
  animation: ${U} 2s infinite linear;
`,R=()=>(0,a.jsx)(T,{children:(0,a.jsx)(h.Z,{})})},86492:(z,c,s)=>{s.d(c,{u:()=>i});var a=s(27279),e=s(87006),m=s(61020),P=s(6606);const i=(O={},g)=>{const{locale:h}=(0,m.Z)(),D=(0,e.Xe)(h,{sensitivity:"base"}),{data:A,error:L,isError:I,isLoading:t,refetch:U}=(0,P.z)(O,g);return{roles:a.useMemo(()=>[...A??[]].sort((R,r)=>D.compare(R.name,r.name)),[A,D]),error:L,isError:I,isLoading:t,refetch:U}}},91224:(z,c,s)=>{s.d(c,{C:()=>m});var a=s(87006),e=s(47853);const m={firstname:e.Z_().trim().required(a.I0.required),lastname:e.Z_(),email:e.Z_().email(a.I0.email).lowercase().required(a.I0.required),username:e.Z_().nullable(),password:e.Z_().min(8,a.I0.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:e.Z_().min(8,a.I0.minLength).oneOf([e.iH("password"),null],"components.Input.error.password.noMatch").when("password",(P,i)=>P?i.required(a.I0.required):i)}}}]);
