"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[1842],{51842:(ls,F,s)=>{s.d(F,{ReviewWorkflowsCreatePage:()=>X});var t=s(74081),l=s(27279),k=s(48102),h=s(10701),Y=s(77970),I=s(32370),D=s(87006),z=s(59082),c=s(71563),H=s(61020),i=s(59461),Z=s(51447),N=s(86492),V=s(25788),o=s(80053),Q=s(6606),G=s(48501),P=s(83758),r=s(41186),O=s(47289),J=s(38684),rs=s(8217),is=s(6078),Es=s(43433),ds=s(47853),Ms=s(15816),Ds=s(97442),Ps=s(13576),Os=s(87830),gs=s(47184),vs=s(364),ms=s(49204),fs=s(74919),hs=s(29206),cs=s(40464),Ls=s(98934),Cs=s(75719),Rs=s(8175),Ts=s(51943),Ws=s(55783),Is=s(92249),As=s(41942),Bs=s(22919),Ks=s(53915),Us=s(75041),ys=s(30200),us=s(91379),ws=s(33299),js=s(33409),xs=s(63645),Ss=s(7988),ps=s(7055),Fs=s(26757),ks=s(58311),Ys=s(24840),zs=s(29510),Hs=s(16946),Zs=s(10124),Ns=s(69530),Vs=s(86961),Qs=s(51527),Gs=s(19764),Js=s(42982),Xs=s(26126),$s=s(28390);const X=()=>{const{formatMessage:a}=(0,H.Z)(),{push:$}=(0,Z.k6)(),{_unstableFormatAPIError:b,_unstableFormatValidationErrors:q}=(0,D.So)(),_=(0,i.I0)(),E=(0,D.lm)(),{collectionTypes:A,singleTypes:B,isLoading:L}=(0,V.u)(),{isLoading:g,meta:K,workflows:v,createWorkflow:ss}=(0,J.u)(),{isLoading:C,roles:U}=(0,N.u)(),m=(0,i.v9)(o.s),ts=(0,i.v9)(o.a),n=(0,i.v9)(o.b),y=(0,i.v9)(o.c),[u,d]=l.useState(null),{isLoading:w,getFeature:os}=(0,G.u)(),[es,as]=l.useState(),[j,R]=l.useState({}),f=os("review-workflows"),x=f?.[O.C],M=f?.[O.a],S=v?.flatMap(e=>e.contentTypes),p=async()=>{R({});try{const e=await ss(n);if("error"in e){(0,Q.x)(e.error)&&e.error.name==="ValidationError"?as(q(e.error)):E({type:"warning",message:b(e.error)});return}E({type:"success",message:{id:"Settings.review-workflows.create.page.notification.success",defaultMessage:"Workflow successfully created"}}),$(`/settings/review-workflows/${e.data.id}`)}catch{E({type:"warning",message:{id:"Settings.review-workflows.create.page.notification.error",defaultMessage:"An error occurred"}})}},ns=async()=>{await p()},_s=()=>{R({})},T=(0,c.TA)({enableReinitialize:!0,initialErrors:es,initialValues:n,async onSubmit(){const e=n.contentTypes?.some(W=>S?.includes(W));K&&x&&K?.workflowCount>=parseInt(x,10)?d("workflow"):n.stages&&M&&n.stages.length>=parseInt(M,10)?d("stage"):e?R(W=>({...W,hasReassignedContentTypes:!0})):p()},validate(e){return(0,o.v)({values:e,formatMessage:a})}});return(0,o.u)(O.R,o.i),l.useEffect(()=>{_((0,o.r)()),!g&&v&&_((0,o.d)({workflows:v})),L||_((0,o.e)({collectionTypes:A,singleTypes:B})),C||_((0,o.f)(U)),_((0,o.g)(L||C)),_((0,o.h)({name:""}))},[A,_,L,C,g,U,B,v]),l.useEffect(()=>{!g&&!w&&n.stages&&f?.[O.a]&&M&&n.stages.length>=parseInt(M,10)&&d("stage")},[w,g,f,n.stages,M]),l.useEffect(()=>{!m&&y?.length===0&&E({blockTransition:!0,type:"warning",message:a({id:"Settings.review-workflows.stage.permissions.noPermissions.description",defaultMessage:"You don\u2019t have the permission to see roles"})})},[a,m,y,E]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(P.D,{}),(0,t.jsx)(c.Hy,{value:T,children:(0,t.jsxs)(c.l0,{onSubmit:T.handleSubmit,children:[(0,t.jsx)(P.H,{navigationAction:(0,t.jsx)(P.B,{href:"/settings/review-workflows"}),primaryAction:(0,t.jsx)(k.z,{startIcon:(0,t.jsx)(z.Z,{}),type:"submit",size:"M",disabled:!ts,children:a({id:"global.save",defaultMessage:"Save"})}),title:a({id:"Settings.review-workflows.create.page.title",defaultMessage:"Create Review Workflow"}),subtitle:a({id:"Settings.review-workflows.page.subtitle",defaultMessage:"{count, plural, one {# stage} other {# stages}}"},{count:n?.stages?.length??0})}),(0,t.jsx)(P.R,{children:(0,t.jsx)(h.k,{alignItems:"stretch",direction:"column",gap:7,children:m?(0,t.jsx)(Y.a,{children:a({id:"Settings.review-workflows.page.isLoading",defaultMessage:"Workflow is loading"})}):(0,t.jsxs)(h.k,{alignItems:"stretch",direction:"column",gap:7,children:[(0,t.jsx)(o.W,{}),(0,t.jsx)(o.S,{stages:T.values?.stages})]})})})]})}),(0,t.jsx)(D.QH.Root,{isConfirmButtonLoading:m,isOpen:Object.keys(j).length>0,onToggleDialog:_s,onConfirm:ns,children:(0,t.jsx)(D.QH.Body,{children:(0,t.jsxs)(h.k,{direction:"column",gap:5,children:[j.hasReassignedContentTypes&&(0,t.jsx)(I.Z,{textAlign:"center",variant:"omega",children:a({id:"Settings.review-workflows.page.delete.confirm.contentType.body",defaultMessage:"{count} {count, plural, one {content-type} other {content-types}} {count, plural, one {is} other {are}} already mapped to {count, plural, one {another workflow} other {other workflows}}. If you save changes, {count, plural, one {this} other {these}} {count, plural, one {content-type} other {{count} content-types}} will no more be mapped to the {count, plural, one {another workflow} other {other workflows}} and all corresponding information will be removed."},{count:S?.filter(e=>n.contentTypes?.includes(e)).length})}),(0,t.jsx)(I.Z,{textAlign:"center",variant:"omega",children:a({id:"Settings.review-workflows.page.delete.confirm.confirm",defaultMessage:"Are you sure you want to save?"})})]})})}),(0,t.jsxs)(r.L.Root,{isOpen:u==="workflow",onClose:()=>d(null),children:[(0,t.jsx)(r.L.Title,{children:a({id:"Settings.review-workflows.create.page.workflows.limit.title",defaultMessage:"You\u2019ve reached the limit of workflows in your plan"})}),(0,t.jsx)(r.L.Body,{children:a({id:"Settings.review-workflows.create.page.workflows.limit.body",defaultMessage:"Delete a workflow or contact Sales to enable more workflows."})})]}),(0,t.jsxs)(r.L.Root,{isOpen:u==="stage",onClose:()=>d(null),children:[(0,t.jsx)(r.L.Title,{children:a({id:"Settings.review-workflows.create.page.stages.limit.title",defaultMessage:"You have reached the limit of stages for this workflow in your plan"})}),(0,t.jsx)(r.L.Body,{children:a({id:"Settings.review-workflows.create.page.stages.limit.body",defaultMessage:"Try deleting some stages or contact Sales to enable more stages."})})]})]})}}}]);
